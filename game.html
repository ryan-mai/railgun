<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Railgun</title>
    <meta name="description" content="Hello, World! - A-Frame">
  <link rel="icon" type="image/x-icon" href="assets/images/railgun_logo.ico">

    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="js/DRACOLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.6.0/dist/aframe-extras.min.js"></script>
    <script src="js/shader-grid-glitch.js"></script>
    <script src="js/leaderboard.js"></script>
    <script src="https://unpkg.com/aframe-troika-text/dist/aframe-troika-text.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
  <script src="js/firebase-config.js"></script>
  <script src="js/checkAuth.js"></script>
  <script src="js/updateScore.js"></script>
  <script src="js/timer.js"></script>
  <script src="js/gameScore.js"></script>
  <script src="js/collisionDetection.js"></script>
  <script src="js/logout.js"></script>
  <script src="js/audioGame.js"></script>
  </head>
  <body>
    <script>
  getTopPlayers().then(players => {
    if (!players || players.length === 0) return;

    const leaderEl = document.getElementById('leaderstats');
    if (!leaderEl) return;
    console.debug('[game] rendering leaderboard entries', players);

    for (let i = 0; i < 3; i++) {
      const p = players[i] || { name: '', score: 0 };
      const display = `${p.name} â€” ${p.score}`;

      const nameLen = (p.name || '').length;
      const baseSize = 0.28;
      const shrinkPerChar = 0.01;
      const shrinkStart = 6;
      const fontSize = Math.max(0.12, baseSize - Math.max(0, nameLen - shrinkStart) * shrinkPerChar);

      const lineEl = document.createElement('a-entity');
      lineEl.setAttribute('troika-text', { value: display, fontSize: fontSize, color: '#fff', anchor: 'left' });
      lineEl.object3D.position.x = -1.75;
      lineEl.object3D.position.y = 0.75 - i * 0.75;
      lineEl.object3D.position.z = 0.05;

      leaderEl.appendChild(lineEl);
    }
  });

      AFRAME.registerComponent('logout', {
        init: function () {
          this.el.addEventListener('click', function (evt) {
            window.location.href = "logout.html";
          });
        }
      });

    </script>

  <a-scene id="scene" auto-audio-resume style="visibility: hidden;">

        <a-assets>
            <img id="leaderboard" src="assets/images/leaderboard.png">
          <a-asset-item id="map" src="assets/models/city.glb"></a-asset-item>
          <a-asset-item id="sinon" src="assets/models/sinon_sniping.glb"></a-asset-item>
          <a-asset-item id="ball" src="assets/models/ball.glb"></a-asset-item>
          <audio id="sao_op" src="assets/sounds/sao_op.mp3" preload="auto"></audio>
          <audio id="shoot" src="assets/sounds/gunshot.mp3" preload="auto"></audio>
          <img id="reticle" src="assets/images/reticle.png">
          <img id="score_bg" src="assets/images/score.png">
          <img id="timer_bg" src="assets/images/timer.png">
          <img id="leaderboard_bg" src="assets/images/leaderboard.png">
          <img id="logout_bg" src="assets/images/logout_button.png">
          <img id="start_bg" src="assets/images/start_game.png">
          <a-asset-item id="futura" src="assets/fonts/futura_v2.ttf"></a-asset-item>

        </a-assets>

        <a-entity sound="src: #sao_op"></a-entity> 
        <a-entity gltf-model="#map" position="1.6 -50 -0.8" rotation="0 200 0" scale="1 1 1"></a-entity>
        <a-sky color="#000"></a-sky>
        <a-image id="logout" logout class="logout" src="#logout_bg" width="5" height="1.25" position="0 -5 -3" rotation="-90 20 0">
            <a-entity troika-text="value: Logout; font: #futura; color: white; fontSize: 0.75; anchor: center" position="-0.9 0 0.01"></a-entity>
        </a-image>

        <a-entity id="tip" position="0 1 -2">
            <a-image src="#start_bg" width="8" height="3" position="0 0.5 -6"></a-image>
        <a-entity troika-text="value: Move your cursor to aim and shoot the sphere above! (No Need to Click); color: black; fontSize: 0.22" position="0 -0.5 -5.9"></a-entity>
        </a-entity>
                <a-entity id="target" class="clickable" clickable  geometry="primitive: sphere; radius: 0.25" material="shader:grid-glitch;"  position="0 2.65 -4" radius="0" sound="src: #shoot; volume= 2.0; on: click"></a-entity>


        <a-image id="leaderstats" src="#leaderboard_bg" width="6" height="4" position="-4.5 3.5 -6" rotation="0 45 0">
          <a-entity troika-text="value: Leaderboard; font: #futura; color: #fff; anchor: center; fontSize: 0.45" position="-1.3 1.2 0.5">
          </a-entity>
          <a-entity troika-text="value: 1.; font: #futura; color: #F5E427; anchor: left; fontSize: 0.45" position="-2.5 0.5 0.5">
          </a-entity>
          <a-entity troika-text="value: 2.; font: #futura; color: #F2F2F2; anchor: left; fontSize: 0.45" position="-2.5 -0.1 0.2"></a-entity>
          <a-entity troika-text="value: 3.; font: #futura; color: #B5831F; anchor: left; fontSize: 0.45" position="-2.45 -0.9 0.5"></a-entity>
        </a-image>

    <a-entity id="bgMusic" sound="src: #sao_op; autoplay: false; loop: true; positional: false; volume: 0"></a-entity>
        <a-entity id="player"
            position-reader
            nipple-controls="mode: static">
        <a-entity
            camera
            position="0 1 0"
            look-controls="true">
            <a-image id="timer_plane" src="#timer_bg" width="4" height="1" position="0.0 3.25 -5">
                <a-entity id="time" timer troika-text="value: 60s; font: #futura; color: #fff; anchor: center; fontSize: 0.35" position="0 -0.3 0.5"></a-entity>
            </a-image>
            <a-image id="score_plane" src="#score_bg" width="3" height="1" position="7.0 3.25 -5">
              <a-entity id="score" troika-text="value: Score: 0; font: #futura; fontSize: 0.35; color: #fff; anchor: center" position="-0.7 -0.3 0.5">
              </a-entity>
            </a-image>
            <a-entity gltf-model="#sinon" animation-mixer="loop: repeat;" position="0 -0.9 -0.7" scale="2 2 2" rotation="0 180 0"></a-entity>
            <a-entity
              id="ray"
              cursor="fuse: true;"
              raycaster="showLine: true; far: 50; lineColor: red; interval: 500; objects: .clickable, .logout;"
              material="color: red; shader: flat"
              position="0 0 0"
              rotation="0 0 0">

              <a-image id="ret" src="#reticle"
                      position="0 0 -10"
                      width="2.5"
                      height="2.5"
                      rotation="0 0 0"
                      material="src: #reticle; transparent: true; alphaTest: 0.01; depthTest: false;">
              </a-image>
            </a-entity>
          </a-entity>
        </a-entity>
    </a-scene>
  </body>
</html>